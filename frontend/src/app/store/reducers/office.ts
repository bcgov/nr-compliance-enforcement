import axios from "axios";
import { Office } from "../../types/office/office";
import { OfficesInZoneState } from "../../types/office/offices-in-zone-state";
import { AppThunk, RootState } from "../store";
import { createSlice } from "@reduxjs/toolkit";
import config from "../../../config";

const initialState: OfficesInZoneState = {
    officesInZone: []
};

export const officeByZoneSlice = createSlice({
  name: "officesByZone",
  initialState,
  // The `reducers` field lets us define reducers and generate associated actions
  reducers: {
    setOfficesInZone: (state, action) => {
      const { payload } = action;
      const officesInZone:Office[] = payload.officesInZone;
      return { ...state, officesInZone};
    },
  },

  // The `extraReducers` field lets the slice handle actions defined elsewhere,
  // including actions generated by createAsyncThunk or in other slices.
  extraReducers: (builder) => {},
});

// export the actions/reducers
export const { setOfficesInZone } = officeByZoneSlice.actions;

// Given a zone, returns a list of persons in that zone.
export const getOfficesInZone = (zone?: string): AppThunk => async (dispatch) => {
  const token = localStorage.getItem("user");
  if (token) {
    axios.defaults.headers.common.Authorization = `Bearer ${token}`;
    
    const response = await axios.get<Office>(`${config.API_BASE_URL}/v1/office/by-zone/${zone}`);
    dispatch(
        setOfficesInZone({
        officesInZone: response.data
      })
    );
  }
};

export const officesInZone = (state: RootState) => { 
    const { officesInZone } = state.officesInZone;
    return officesInZone;
  }
  
  export default officeByZoneSlice.reducer;