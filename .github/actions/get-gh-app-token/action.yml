name: Get GitHub App Access Token
description: Get an access token for the GitHub app to perform authenticated API requests with
branding:
  icon: shield
  color: blue

inputs:
  github_app_id:
    description: Provide the id of the GitHub app
  github_app_private_key:
    description: Provide the base-64 encoded private key for the GitHub app specified in github_app_id

outputs:
  token:
    description: "Access token for the GitHub app"
    value: ${{ steps.app_token.outputs.token }}
  app_slug:
    description: "Slug of the GitHub app"
    value: ${{ steps.app_token.outputs.app_slug }}

runs:
  using: composite
  steps:
    - name: Decode the GitHub App Private Key
      id: decode_app_private_key
      shell: bash
      run: |
        private_key=$(echo "${{ inputs.github_app_private_key }}" | base64 -d | awk 'BEGIN {ORS="\\n"} {print}' | head -c -2) &> /dev/null
        echo "::add-mask::$private_key"
        echo "app_private_key=$private_key" >> "$GITHUB_OUTPUT"

    - uses: actions/create-github-app-token@v1
      id: app_token
      with:
        app-id: ${{ inputs.github_app_id }}
        private-key: ${{ steps.decode_app_private_key.outputs.app_private_key }}
      run: |
        echo "app_slug=${{ steps.app_token.outputs.app-slug }}" >> "$GITHUB_OUTPUT"
